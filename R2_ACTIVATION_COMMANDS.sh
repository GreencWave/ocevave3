#!/bin/bash
# R2 í™œì„±í™” í›„ ì‹¤í–‰í•  ëª…ë ¹ì–´ ëª¨ìŒ

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  R2 ì„¤ì • ìë™í™” ìŠ¤í¬ë¦½íŠ¸"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "âš ï¸  ì£¼ì˜: ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì—"
echo "   Cloudflare Dashboardì—ì„œ R2ë¥¼ í™œì„±í™”í•´ì•¼ í•©ë‹ˆë‹¤!"
echo ""
echo "   ğŸ‘‰ https://dash.cloudflare.com â†’ R2 â†’ Enable R2"
echo ""
read -p "R2ë¥¼ í™œì„±í™”í–ˆìŠµë‹ˆê¹Œ? (y/n): " answer

if [ "$answer" != "y" ]; then
    echo "âŒ R2 í™œì„±í™” í›„ ë‹¤ì‹œ ì‹¤í–‰í•´ì£¼ì„¸ìš”."
    exit 1
fi

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "1ï¸âƒ£  R2 í™œì„±í™” í™•ì¸ ì¤‘..."
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
npx wrangler r2 bucket list

if [ $? -ne 0 ]; then
    echo "âŒ R2ê°€ ì•„ì§ í™œì„±í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
    echo "   Dashboardì—ì„œ R2ë¥¼ í™œì„±í™”í•œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
    exit 1
fi

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "2ï¸âƒ£  R2 ë²„í‚· ìƒì„± ì¤‘... (ocevave-images)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
npx wrangler r2 bucket create ocevave-images

if [ $? -eq 0 ]; then
    echo "âœ… R2 ë²„í‚· ìƒì„± ì™„ë£Œ!"
else
    echo "âš ï¸  ë²„í‚·ì´ ì´ë¯¸ ì¡´ì¬í•˜ê±°ë‚˜ ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ"
fi

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "3ï¸âƒ£  ìƒì„±ëœ ë²„í‚· í™•ì¸"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
npx wrangler r2 bucket list

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… R2 ë²„í‚· ì„¤ì • ì™„ë£Œ!"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ“Œ ë‹¤ìŒ ë‹¨ê³„:"
echo ""
echo "4ï¸âƒ£  Cloudflare Pagesì— R2 ë°”ì¸ë”© ì¶”ê°€"
echo "   1. https://dash.cloudflare.com ì ‘ì†"
echo "   2. Pages â†’ ocevave â†’ Settings â†’ Functions"
echo "   3. R2 Bucket Bindings ì„¹ì…˜"
echo "   4. Add binding í´ë¦­"
echo "   5. Variable name: R2"
echo "   6. R2 bucket: ocevave-images"
echo "   7. Save í´ë¦­"
echo ""
echo "5ï¸âƒ£  ì¬ë°°í¬"
echo "   ì˜µì…˜ A: Dashboardì—ì„œ Retry deployment í´ë¦­"
echo "   ì˜µì…˜ B: í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰"
echo "      cd /home/user/webapp"
echo "      npm run build"
echo "      npx wrangler pages deploy dist --project-name ocevave"
echo ""
echo "6ï¸âƒ£  í…ŒìŠ¤íŠ¸"
echo "   https://fabf91b6.ocevave.pages.dev/admin"
echo "   ëŒ€ìš©ëŸ‰ ì´ë¯¸ì§€(ìµœëŒ€ 50MB) ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
